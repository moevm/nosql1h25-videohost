# Нереляционная модель

## Описание назначений коллекций, типов данных и сущностей
Пользователи (users):
- id: ObjectId (12 байт)
- username: String (до 50 символов, ~50 байт)
- email: String (до 100 символов, ~100 байт)
- password: String (60 байт для bcrypt)
- registrationDate: Date (8 байт)
- subscriberCount: Integer (4 байта)
  Итого: ~234 байта на пользователя

Видео (videos):
- id: ObjectId (12 байт)
- userId: ObjectId (12 байт)
- title: String (до 100 символов, ~100 байт)
- description: String (до 5000 символов, ~5000 байт)
- s3Key: String (до 255 символов, ~255 байт)
- views: Integer (4 байта)
- uploadDate: Date (8 байт)
- durationSeconds: Integer (4 байта)
- tags: Array (до 10 элементов по 20 байт каждый, ~200 байт)
  Итого: ~5595 байт на видео

Комментарии (comments):
- id: ObjectId (12 байт)
- userId: ObjectId (12 байт)
- videoId: ObjectId (12 байт)
- text: String (до 1000 символов, ~1000 байт)
- timestamp: Date (8 байт)
  Итого: ~1044 байта на комментарий

Лайки (likes):
- id: ObjectId (12 байт)
- userId: ObjectId (12 байт)
- videoId: ObjectId (12 байт)
- timestamp: Date (8 байт)
  Итого: 44 байта на лайк

## Оценка объема информации, хранимой в модели
Общий объем данных можно выразить через количество пользователей (U), видео (V), комментариев (C) и лайков (L):

```sh
TotalSize = 234*U + 5595*V + 1044*C + 44*L + S3Content
```

На 1 пользователя 10 видео, на 1 видео 5 комментариев и 50 лайков:

```sh
TotalSize ≈ 234*U + 5595*(10*U) + 1044*(5*10*U) + 44*(50*10*U)
          ≈ 234*U + 55950*U + 52200*U + 22000*U
          ≈ 130,384*U байт ≈ 130.4 KB на пользователя
```

## Избыточность модели
Чистый объем данных (без служебных полей и индексов):
```sh
PureSize ≈ (50+100+60)*U + (100+5000+255)*V + (1000)*C + (0)*L
         ≈ 210*U + 5355*V + 1000*C
```

Избыточность:

```sh
Redundancy = (TotalSize - PureSize) / PureSize
           ≈ (130,384*U - (210*U + 5355*10*U + 1000*5*10*U)) / (210*U + 53550*U + 50000*U)
           ≈ (130,384 - 103,760) / 103,760 ≈ 0.256 или 25.6%
```

## Направление роста модели при увеличении количества объектов каждой сущности.
При увеличении количества:
- Пользователей: линейный рост (O(U))
- Видео: линейный рост (O(V)), но в 24 раза больше на единицу, чем пользователи
- Комментариев: линейный рост (O(C)), в 4.5 раза больше на единицу, чем видео
- Лайков: линейный рост (O(L)), но очень компактные записи

## Примеры хранения данных в БД для модели

Пользователь:
```json
{
  "id": ObjectId("5f8d8a7f4d4e4b2d4c8b4567"),
  "username": "johndoe",
  "email": "john@example.com",
  "password": "$2a$10$N9qo8uLOickgx2ZMRZoMy...",
  "registrationDate": ISODate("2020-10-20T14:48:00Z"),
  "subscriberCount": 1500
}
```
Видео:
```json
{
  "id": ObjectId("5f8d8a7f4d4e4b2d4c8b4568"),
  "userId": ObjectId("5f8d8a7f4d4e4b2d4c8b4567"),
  "title": "How to use MongoDB",
  "description": "A comprehensive tutorial...",
  "s3Key": "videos/5f8d8a7f4d4e4b2d4c8b4568.mp4",
  "views": 12500,
  "uploadDate": ISODate("2020-10-21T09:15:00Z"),
  "durationSeconds": 600,
  "tags": ["tutorial", "database", "mongodb"]
}
```

## «Примеры запросов» - запросы к модели, с помощью которых реализуются сценарии использования

# Реляционная модель

## Описание назначений коллекций, типов данных и сущностей
USER
- id: INT (4 байта)
- username: VARCHAR(50) (~50 байт)
- email: VARCHAR(100) (~100 байт)
- password: VARCHAR(60) (60 байт)
- registration_date: DATETIME (8 байт)
- subscriber_count: INT (4 байта)
  Итого: ~226 байт на пользователя

VIDEO
- id: INT (4 байта)
- user_id: INT (4 байта)
- title: VARCHAR(100) (~100 байт)
- description: TEXT (~5000 байт)
- s3_key: VARCHAR(255) (~255 байт)
- views: INT (4 байта)
- upload_date: DATETIME (8 байт)
- duration_seconds: INT (4 байта)
  Итого: ~5383 байта на видео

VIDEO_TAG
- video_id: INT (4 байта)
- tag: VARCHAR(20) (~20 байт)
  Итого: 24 байта на тег

COMMENT
- id: INT (4 байта)
- user_id: INT (4 байта)
- video_id: INT (4 байта)
- comment_text: TEXT (~1000 байт)
- timestamp: DATETIME (8 байт)
  Итого: ~1020 байт на комментарий

LIKE
- user_id: INT (4 байта)
- video_id: INT (4 байта)
- timestamp: DATETIME (8 байт)
  Итого: 16 байт на лайк

## Оценка объема информации, хранимой в модели
Общий объем данных можно выразить через количество пользователей (U), видео (V), комментариев (C) и лайков (L):

```sh
TotalSizeSQL = 226*U + 5383*V + 24*T + 1020*C + 16*L
```

10 видео на пользователя, 5 тегов на видео, 5 комментариев на видео, 50 лайков на видео:

```sh
TotalSizeSQL ≈ 226*U + 5383*(10*U) + 24*(5*10*U) + 1020*(5*10*U) + 16*(50*10*U)
             ≈ 226*U + 53830*U + 1200*U + 51000*U + 8000*U
             ≈ 114,256*U байт ≈ 114.3 KB на пользователя
```

## Избыточность модели
Чистый объем данных:
```sh
PureSizeSQL ≈ (50+100+60)*U + (100+5000+255)*V + (20)*T + (1000)*C
            ≈ 210*U + 5355*V + 20*T + 1000*C
```

Избыточность:

```sh
RedundancySQL = (114,256*U - (210*U + 5355*10*U + 20*5*10*U + 1000*5*10*U)) / 
                (210*U + 53550*U + 1000*U + 50000*U)
              ≈ (114,256 - 104,760) / 104,760 ≈ 0.091 или 9.1%
```

## Направление роста модели при увеличении количества объектов каждой сущности.
При увеличении количества:
Пользователи (USERS):
- Линейный рост O(U)
- Каждый новый пользователь добавляет ~226 байт
- Вторичный рост: каждый пользователь потенциально создает видео, комментарии, лайки

Видео (VIDEOS):
- Линейный рост O(V), но в 24 раза больше на единицу, чем пользователи
- Каждое видео добавляет ~5383 байта + 5 тегов по 24 байта = ~5503 байта
- Основной драйвер роста базы данных

Теги (VIDEO_TAGS):
- Линейный рост O(T), зависит от количества видео
- Обычно 5-10 тегов на видео, каждый добавляет 24 байта

Комментарии (COMMENTS):
- Линейный рост O(C), в среднем 5 комментариев на видео
- Каждый комментарий добавляет ~1020 байт
- Может стать значительной частью базы при активном комментировании

Лайки (LIKES):
- Линейный рост O(L), в среднем 50 лайков на видео
- Компактные записи (16 байт), но при массовых лайках объем может быть значительным

## Примеры хранения данных в БД для модели

## «Примеры запросов» - запросы к модели, с помощью которых реализуются сценарии использования

# Сравнение моделей
A. Удельный объем информации
- NoSQL: ~130.4 KB на пользователя
- SQL: ~114.3 KB на пользователя

SQL модель более компактна (на ~12.4% меньше объема) благодаря:
- Отсутствию избыточных ObjectId (12 байт vs 4 байта INT)
- Нормализованным структурам (отдельная таблица для тегов)
- Отсутствию служебных полей MongoDB

B. Запросы по юзкейсам
1. Просмотр видео с метаданными:
- NoSQL: 5 запросов
- SQL: 4 запроса (можно сократить до 2-3 с джойнами)
2. Лента подписок:
- NoSQL: 3 запроса
- SQL: 1 запрос (с джойнами)

3. Добавление комментария:
- NoSQL: 1 запрос (вставка)
- SQL: 1 запрос (вставка) + возможно 1 запрос на обновление счетчика

# Вывод

Для видеохостинга NoSQL (MongoDB) модель предпочтительнее по следующим причинам:
1. Гибкость схемы: Легко добавлять новые поля к видео или пользователям без миграций
2. Производительность на чтение: Вложенные структуры (комментарии, лайки) можно денормализовать для уменьшения JOIN-ов
3. Масштабируемость: Горизонтальное масштабирование MongoDB лучше подходит для высоконагруженных сервисов
4. Хранение медиа: Лучшая интеграция с S3 через ссылки в документах

SQL модель выигрывает в:
- Целостности данных (внешние ключи)
- Более компактном хранении
- Сложных аналитических запросах (но это не основной сценарий для видеохостинга)